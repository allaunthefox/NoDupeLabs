[build-system]
requires = ["setuptools>=61.0"]
build-backend = "setuptools.build_meta"

[project]
name = "nodupe"
version = "0.1.0"
description = "Next-generation context-aware file deduplication and organization system"
authors = [{name = "Allaun"}]
license = {text = "Apache-2.0"}
requires-python = ">=3.9"
dependencies = [
    "PyYAML",
    "tqdm",
    "xxhash",
    "zstandard",
    "py7zr",
    "rarfile",
    "jsonschema"
]

[project.scripts]
nodupe = "nodupe.cli:main"

[tool.setuptools.packages.find]
where = ["."]

[tool.interrogate]
ignore-init-module = false
ignore-init-method = true
ignore-module = false
ignore-nested-functions = true
ignore-magic = false
ignore-private = true
ignore-semiprivate = true
exclude = ["setup.py", "docs", "build", "tests", "nodupe/vendor"]
fail-under = 95
verbose = 2
color = true

[tool.pydocstyle]
convention = "google"
match-dir = "nodupe"
# D100: Missing docstring in public module (we enforce this via interrogate mostly, but good to have)
# D104: Missing docstring in public package
# D107: Missing docstring in __init__
add-ignore = ["D107"]

[tool.mypy]
python_version = "3.9"
exclude = [
    "vendor",
    "nodupe/vendor",
    ".venv",
    "build",
    "dist"
]
warn_return_any = false
warn_unused_configs = true
warn_redundant_casts = true
warn_unused_ignores = false
disallow_untyped_defs = false
check_untyped_defs = false
ignore_missing_imports = true
no_implicit_optional = true
show_error_codes = true

[[tool.mypy.overrides]]
module = "nodupe.vendor.*"
ignore_errors = true

[[tool.mypy.overrides]]
module = [
    "nodupe.mount",
    "nodupe.plugins.manager",
    "nodupe.similarity.backends.*"
]
# Modules with known issues that don't affect core functionality:
# - mount: Optional FUSE dependency
# - plugins.manager: Dynamic plugin loading
# - similarity backends: Optional dependencies (faiss)
ignore_errors = true

[tool.pytest.ini_options]
minversion = "7.0"
testpaths = ["tests"]
python_files = ["test_*.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]
markers = [
    "unit: Fast unit tests that don't require external dependencies",
    "integration: Integration tests that may require external resources",
    "slow: Tests that take more than 1 second to complete",
    "requires_model: Tests that require ML models to be present",
    "requires_ffmpeg: Tests that require ffmpeg to be installed"
]
addopts = "-ra --strict-markers"
filterwarnings = [
    "error::DeprecationWarning:nodupe.*"
]

